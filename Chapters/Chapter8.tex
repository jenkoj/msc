% Chapter Template

\chapter{t-SNE} % Main chapter title

\label{Chapter8} % Change X to a consecutive number; for referencing this chapter elsewhere, use \ref{ChapterX}

%----------------------------------------------------------------------------------------
%	SECTION 1
%----------------------------------------------------------------------------------------

\section{Introduction}

The load profiles can present data in a new, previously unseen way, that can enable users or algorithms to extract activation patterns.
The one thing they do not offer is a comparison between activation patterns.
One such example would be when checking how similar are certain usage patterns.
This could be usage patterns within a household, where we are looking for appliances that are used similarly,
or when observing multiple buildings how their consumption differs. 

To measure the similarity of activation profiles, the t-SNE algorithm will be used.

Although the use-cases were presented in-depth in a separate chapter, it is worth mentioning one specific use case.
The increasing price of energy resources, could lead to over-saving and living in cool homes.
Using similarity metrics between profiles across different buildings, it would be possible to detect outliers when it comes to heating. 
Using this approach it would be possible to detect users, that are living in below-average cool homes, and offer them cheaper plans. 

\section{Goals}

The chapter will demonstrate the application of previously unused load profiles,
and show the practical use case using a t-SNE neighboring algorithm.

\section{Methodology}

\subsection{Load profiles}

During testing, a weekly-daily load profile constructed from a month of data will be used.
Y-axis will present the days in a week and X-axis presents the hours in a day.
Days are labeled from 0 to 6, and hours from 0 to 23.
Since we are working with images, the origin is placed in the upper-left corner. 
This means that a pixel in the upper-left corner presents the first hour in a week,
this would be a Monday from midnight to one o'clock. 
The lower-right corner presents the last hour of a week.
Since there are roughly 4 weeks in each month, each pixel will present 4 samples. 

\subsection{Datasets}

To present the results REFIT, UK-DALE, ECO, REDD and iAWE datasets will be used.
Combined datasets include data for over 25 homes, where some have up to 5 years of data. 

The structure of datasets will be analyzed in larger depth in the next chapter. 
\subsection{t-SNE}

t-SNE \cite{tsne2} or t-distribution stochastic neighboring embedding is a method for portraying high dimensional 
data in low dimensional space. This process is also known as dimensionality reduction.

One of the well-known dimensionality reduction algorithms is PCA.
The key difference between the two is that one is linear, and the other is non-linear.
PCA, linear, projects data on new space and finds the one with the least variance between data points.
SNE \cite{sne1}, non-linear, is composed of two main parts. The first one is 
converting the high-dimensional Euclidean distances between data points into conditional probabilities that represent similarities. \cite{sne1}
The pairs with high similarity have a high probability, and pairs with lower a low probability.
Second, it uses Kullback-Leibler divergence to minimize it with respect to a location on a map.
To achieve this it uses gradient descent to minimize the cost function.
Over many iterations, similar data points should be close together and far away from dissimilar objects.
Similar data points usually form clusters. 

t-SNE uses SNE as a basis, except that it uses t-student distribution instead of normal in order to calculate the similarity.

In our case, two dimensions will be used. Since this is non-linear dimensionality reduction,
the axis usually presents dimensions that are hard to comprehend by the human eye. 
Since the algorithm uses similarity at the base of the algorithm, it is possible to 
see which samples are more similar to each other.

\subsection{Tools used}

To process the data and to obtain results Google Colab was used.
For handling the data python libraries such as h5py, pandas and NumPy were used.
To present the data Seaborn and Matplotlib libraries were used.
To implement the t-SNE a SciPy library was used.

\section{Results}

The results will be presented in three subsections, these are

\begin{itemize}
	\item Per-building load profile
	\item Per-appliance load profile
	\item Per-building per-appliance load profile
\end{itemize}

Most of the focus will be done on the per-appliance load profile since it is the most universal.

\subsection{Results for per-building load profiles}

This load profile is useful when it comes to comparing how 
activation patterns change over buildings and datasets.

Figure \ref{fig:tsne_scatter_non_norm_all} is using non-normalized data, meaning
the number of appliances in a building will affect the end load profile.
The algorithm could pick up on how much a certain appliance is used.
In some cases this information is useful, 
again in others we would like to find a more complex usage pattern.

\begin{figure}[H]
	\centering
	\caption{"Projection of per-building load profiles"}
	\includegraphics[width=1.2\textwidth]{Figures/TSNE/TSNE_per_building/non_norm/scatter_non_norm_all.png}
	\label{fig:tsne_scatter_non_norm_all}
\end{figure}

The figure \ref{fig:tsne_pb_img_scatter_allall} presents the actual load profile behind each sample. 
It is possible to see that on the left there are mostly samples with very little activity,
and on the left, we see samples with more activity.
Since the two plotted components are of a higher dimension, it is hard to guess what they present.
As said t-SNE gives us the intuition of how load profiles are connected in higher-dimensional space.

\begin{figure}[H]
	\centering
	\caption{"Projection of per-building load profiles with actual samples"}
	\includegraphics[width=.9\textwidth]{Figures/TSNE/TSNE_per_building/non_norm/img_scatter_allall.png}
	\label{fig:tsne_pb_img_scatter_allall}
\end{figure}

\subsubsection{Normalized load profiles}

To solve the issue mentioned we have to normalize the data between 0 and 1.
The figure \ref{fig:tsne_pb_scatter_all_all} shows how normalizing samples affect the algorithm.
The samples are much closer to each other, while it is still possible to see the individual clusters.
This could imply that the usage pattern of users is more similar than the amount of it they use.

\begin{figure}[H]
	\centering
	\caption{"Projection of normalised per-building load profiles"}
	\includegraphics[width=1.2\textwidth]{Figures/TSNE/TSNE_per_building/all/scatter_all_all.png}
	\label{fig:tsne_pb_scatter_all_all}
\end{figure}

The figure \ref{fig:tsne_pb_img_norm_scatter_allall} presents only the main cluster of samples,
since the smaller cluster presents mostly low entropy data. 
Same cluster can be seen on far left on figure \ref{fig:tsne_pb_img_scatter_allall}.

\begin{figure}[H]
	\centering
	\caption{"Projection of normalised per-building load profiles with actual samples"}
	\includegraphics[width=.9\textwidth]{Figures/TSNE/TSNE_per_building/all/img_scatter_allall.png}
	\label{fig:tsne_pb_img_norm_scatter_allall}
\end{figure}

On figure \ref{fig:tsne_pb_img_norm_scatter_allall} it is possible to find all kinds of 
usage patterns. But the general one is that there is less activation during the night,
Then there is one peak during the morning and again once in the evening.
Some buildings are more active during the week and again others during the weekend.
Most of the data is from UK-DALE building 1 (pink box). It is possible to see that the building
has one big cluster where activations are generally similar, then there are some outliers,
where the pattern completely changed. Albeit less obvious, the same happens overall buildings.
This happens due to events such as vacations, holidays or weather-induced behavioral changes.

\subsection{Per-appliance}

We can use per appliance load profiles to examine how different appliances 
are used in a single building, how a single appliance is being used across other buildings
or how many appliances are being used in many buildings.

\subsubsection{Single appliance over many buildings}

Using only one appliance and using the building as a label,
allows us to examine how the same type of appliance is being used across different buildings.

Fridges are generally a bad indicator when it comes to user behavior since the user does not affect 
its operation, apart from opening the door and turning on the light inside. 
Usually, this event is dwarfed by the number of activations of a compressor. 
This also means that the usage pattern should be the same across all buildings. 
This can be seen on figure \ref{fig:tsne_pa_scatter_all_fridge}, 
where apart from REFIT building 1 and 11, there are no clusters.

\begin{figure}[H]
	\centering
	\caption{"Projection of fridge load profiles for various buildings"}
	\includegraphics[width=1.2\textwidth]{Figures/TSNE/TSNE_per_appliance/all/scatter_all_fridge_freeezer_fridge freezer.png}
	\label{fig:tsne_pa_scatter_all_fridge}
\end{figure}

Figure \ref{fig:tsne_pa_img_scatter_all_fridge} Shows mostly bright images, apart from few outliers.
Load profiles scattered in a circle are generally less dynamic than the ones at the bottom.
The figure \ref{fig:tsne_pa_img_scatter_all_fridge} is a good example how even little to none human
interaction, load profiles can look a lot different. This could be due to different makes of the 
appliances, malfunctions of the appliance or the meter measuring it.

\begin{figure}[H]
	\centering
	\caption{"Projection of fridge load profiles for various buildings with actual samples"}
	\includegraphics[width=.9\textwidth]{Figures/TSNE/TSNE_per_appliance/all/img_scatter_allfridge_freeezer_fridge freezer.png}
	\label{fig:tsne_pa_img_scatter_all_fridge}
\end{figure}

Figure \ref{fig:tsne_pa_scatter_all_kettle} shows how,
compared to fridges, kettles have much more clear clusters that are spaced out between each other. 
This could mean that every household uses a kettle a bit differently.
This cluster is a good example where we can see how strong is a routine of a user,
The closer together the clusters, the higher the routine since samples have to be 
close to each other.

\begin{figure}[H]
	\centering
	\caption{"Projection of kettle load profiles for various buildings"}
	\includegraphics[width=1.2\textwidth]{Figures/TSNE/TSNE_per_appliance/all/scatter_all_kettle.png}
	\label{fig:tsne_pa_scatter_all_kettle}
\end{figure}

The figure \ref{fig:tsne_pa_img_scatter_all_kettle} shows us that images on the lower part 
of the plot contain less activity than the others. It is also possible to observe that
load profiles that are closer together have more similar activation patterns.
The strength of a routine is an important feature that will be used
in the next chapter to build an elderly care anomaly system.

\begin{figure}[H]
	\centering
	\caption{"Projection of kettle load profiles for various buildings with actual samples"}
	\includegraphics[width=.9\textwidth]{Figures/TSNE/TSNE_per_appliance/all/img_scatter_allkettle.png}
	\label{fig:tsne_pa_img_scatter_all_kettle}
\end{figure}

The figure \ref{fig:tsne_pa_scatter_all_microwave} shows that microwaves are again a bit different from the kettle.
They are more clustered than the fridges, and less than the kettles, even though they are used similarly.
This could be due to additional electronics such as a clock that are built into,
the appliance, this could lead to some samples being required as turned on due to 
"dark" current. One other difference between the two is that microwave has more than one mode of operation.

\begin{figure}[H]
	\centering
	\caption{"Projection of microwave load profiles for various buildings"}
	\includegraphics[width=1.2\textwidth]{Figures/TSNE/TSNE_per_appliance/all/scatter_all_microwave.png}
	\label{fig:tsne_pa_scatter_all_microwave}
\end{figure}

The faulty samples could be the ones in the upper left part of the plot since they are too bright.
They do present a pattern, but it is questionable what it presents since it seems like it's turned on 
during the nighttime. Images at the other end show less lot less activity, which could indicate that
the household does not use microwaves as much. The most interesting load profiles are in the middle of the 
plot, where it is possible to observe clear activation patterns. 

\begin{figure}[H]
	\centering
	\caption{"Projection of microwave load profiles for various buildings with actual samples"}
	\includegraphics[width=.9\textwidth]{Figures/TSNE/TSNE_per_appliance/all/img_scatter_allmicrowave.png}
	\label{fig:tsne_pa_img_scatter_all_microwave}
\end{figure}

The last per-appliance example is television presented on figure\ref{fig:tsne_pa_scatter_all_tv}. 
Television was chosen since they were common across all datasets.
Interestingly enough, televisions form nice clusters with a few outliers.
Clusters are separated but close together, this could mean that usage patterns are unique
but not that different from one another. 
The load profiles in some clusters are also close to each other, which could also indicate 
a higher routine.

\begin{figure}[H]
	\centering
	\caption{"Projection of TV load profiles for various buildings"}
	\includegraphics[width=1.2\textwidth]{Figures/TSNE/TSNE_per_appliance/all/scatter_all_television.png}
	\label{fig:tsne_pa_scatter_all_tv}
\end{figure}

The images on the figure behind clusters on proving the fact that outliers' consumption is a lot different.
Again the bright images could be the results of faulty appliances, faulty meters or simply odd behavior.

\begin{figure}[H]
	\centering
	\caption{"Projection of TV load profiles for various buildings with actual samples"}
	\includegraphics[width=.9\textwidth]{Figures/TSNE/TSNE_per_appliance/all/img_scatter_alltelevision.png}
	\label{fig:tsne_pa_img_scatter_all_tv}
\end{figure}

\subsubsection{Per-appliance load profiles - comparing appliances}

The figure \label{fig:tsne_papb_scatter_all} presents
the general picture of where each appliance lays in comparison to each other.
One obvious issue here is that there are to many appliances, and it is impossible to comprehend the plot.
\begin{figure}[H]
	\centering
	\caption{"Projection of per-appliance load profiles"}
	\includegraphics[width=1.2\textwidth]{Figures/TSNE/TSNE_results/all/scatter_all_all_lgimgs.png}
	\label{fig:tsne_papb_scatter_all}
\end{figure}

The same goes for image presentation. 
We can see, that most active appliances are in the bottom left,
by moving to the upper right part of the corer, we can see less and less activity.
Less activity does not necessarily mean that load profiles contain less information about user behavior.

\begin{figure}[H]
	\centering
	\caption{"Projection of per-appliance load profiles with actual samples"}
	\includegraphics[width=.9\textwidth]{Figures/TSNE/TSNE_results/all/img_scatter_allall_lgimgs.png}
	\label{fig:tsne_papb_img_scatter_all}
\end{figure}

To get a general idea of where each appliance group lies,
let's filter out all appliances that have less than 150 samples.
Applying this filter yields figure \ref{fig:tsne_papb_scatter_all_reduced}.

\begin{figure}[H]
	\centering
	\caption{"Projection of filtered per-appliance load profiles"}
	\includegraphics[width=1.1\textwidth]{Figures/TSNE/TSNE_results/all/scatter_all_all_reduced_max.png}
	\label{fig:tsne_papb_scatter_all_reduced}
\end{figure}

The figure \ref{fig:tsne_papb_scatter_all_reduced} shows how these 10 appliances ares connected in high dimensional space.
Kettle, microwave and toaster are quite similar when it comes to usage patterns.
They are operated for a short amount of time and are usually used in users' routines in the morning or evening.
These appliances are located in the upper left part of the plot.

The second group of appliances that are quite near each other is white
goods (without fridges) such as washing machines, dishwashers, dryers etc.
Let's say that they are white goods with a program. 
This group of appliances is located in the upper right part of the plot.

The third group of appliances is white goods with a compressor.
They are usually not affected by human interaction and are therefore harder to cluster.
They are located in the lower part of the plot.

The final group of appliances is televisions and computers. They lie 
on a bridge between the fridges and other groups. 

\begin{figure}[H]
	\centering
	\caption{"Projection of filtered per-appliance load profiles with actual samples"}
	\includegraphics[width=.9\textwidth]{Figures/TSNE/TSNE_results/all/img_scatter_allall_reduced_max.png}
	\label{fig:tsne_papb_img_scatter_all_reduced}
\end{figure}

All through the set of load profiles is different due to filtering,
the figure \ref{fig:tsne_papb_img_scatter_all_reduced},
retains a similar structure to the previous figure \ref{fig:tsne_papb_scatter_all_reduced}. 

Knowing that a pattern exists, we can use the newly found group to define new appliance groups.
The following 8 groups will be defined
\begin{itemize}
    \item Kitchen appliances - toasters, ovens, microwaves, etc.
    \item Fridges and freezers  - contains fridges, freezers and fridge freezers or white goods with a compressor
    \item White goods - washers, dryers, dishwashers i.e. white goods with a program
    \item heating and cooling - Electric radiators, dehumidifiers and HVACs
    \item leisure -  Living room appliances such as TVs, games consoles, audio amps, HTPCs, etc.
    \item home office - Computer, laptops, printers, network equipment, chargers, etc.
    \item lightning - lights and lamps
    \item Others - unknown and unlabeled appliances
\end{itemize}

Applying these groups yields figure \ref{fig:tsne_papb_scatter_all_groups}.
The new plot shows how, although appliances could be used by a different
user, maybe even by users in a different part of the EU or world,
they can be grouped in a high-dimensional space. 

\begin{figure}[H]
	\centering
	\caption{"Projection of grouped per-appliance load profiles"}
	\includegraphics[width=.8\textwidth]{Figures/TSNE/TSNE_results/all/scatter_all_all_groups.png}
	\label{fig:tsne_papb_scatter_all_groups}
\end{figure}

The image below is the same as the first one in the subsection,
except it is easier to use color to see the appliance they present

\begin{figure}[H]
	\centering
	\caption{"Projection of grouped per-appliance load profiles with actual samples"}
	\includegraphics[width=.9\textwidth]{Figures/TSNE/TSNE_results/all/img_scatter_all_all_groups.png}
	\label{fig:tsne_papb_img_scatter_all_groups}
\end{figure}

The figure \ref{fig:t-sne_zoomed} shows the four main types of profiles for readers that do not have the ability to zoom in.

\begin{figure}[H]
	\centering
	\caption{"Projection of grouped per-appliance load profiles with actual samples"}
	\includegraphics[width=.9\textwidth]{Figures/TSNE/TSNE_results/all/t-sne_zoomed.png}
	\label{fig:t-sne_zoomed}
\end{figure}

One issue that causes the t-SNE algorithm an issue is low entropy data or 
in other words, images that are almost completely dark or white, due to various faults in appliances or measurements.

If we calculate entropy for each image and set a threshold, it is possible to filter out these samples. 
By setting an entropy threshold of 0.5, we filter out around 5 \% of all samples. 

\begin{figure}[H]
	\centering
	\caption{"Projection of entropy filtered per-appliance load profiles"}
	\includegraphics[width=.8\textwidth]{Figures/TSNE/TSNE_results_entropy/all/scatter_all_all.png}
	\label{fig:tsne_papb_scatter_ent_all_groups}
\end{figure}

Again, we can apply appliance grouping and get nicely formed clusters, such as can be seen in figure \ref{fig:tsne_papb_img_scatter_ent_all_groups}.

\begin{figure}[H]
	\centering
	\caption{"Projection of entropy filtered per-appliance load profiles with actual samples"}
	\includegraphics[width=.8\textwidth]{Figures/TSNE/TSNE_results_entropy/all/scatter_all_all_groups.png}
	\label{fig:tsne_papb_img_scatter_ent_all_groups}
\end{figure}


\subsubsection{Comparing appliances in a building}

It is also possible to use per-appliance data to study
individual buildings, and how each appliance is used.

\begin{figure}[H]
	\centering
	\caption{"Projection of per-appliance load profiles in a single building"}
	\includegraphics[width=.8\textwidth]{Figures/TSNE/TSNE_results/refit/scatter_refit_8.png}
	\label{fig:tsne_papb_scatter_ent_refit8}
\end{figure}

In general, the scattering is similar to before
fridge and freezers are placed opposite of white goods and kitchen appliances and 
televisions lie somewhere in between. 

\begin{figure}[H]
	\centering
	\caption{"Projection of per-appliance load profiles in a single building with actual samples"}
	\includegraphics[width=.9\textwidth]{Figures/TSNE/TSNE_results/refit/img_scatter_refit8.png}
	\label{fig:tsne_papb_img_scatter_ent_refit8}
\end{figure}

\subsection{Per-appliance per-building}
To study the usage by comparing all appliances between buildings,
we have to use one of the proposed load profiles.

\subsubsection{Bag off appliances}
This load profile is a combination of the load profiles above,
except it offers a larger detail when observing groups of appliances.
Since we are using one dimension for appliances, we will use only the daily dimension.

To construct such a profile we need a universal way of constructing it.
This is done by measuring how many times each appliance occurs in the datasets,
then this list is sorted from most common to least common, and finally, it is cut at 30 Appliances.

The results are appliances in the following order:

\begin{itemize}
	\item fridge freezer
	\item freezer
	\item fridge
	\item computer
	\item television
	\item light
	\item kettle
	\item boiler
	\item broadband router
	\item microwave
	\item washing machine
	\item dish washer
	\item HTPC
	\item toaster
	\item solar thermal pumping station
	\item audio amplifier
	\item laptop computer
	\item active subwoofer
	\item unknown
	\item washer dryer
	\item computer monitor
	\item audio system
	\item tumble dryer
	\item pond pump
	\item desktop computer
	\item ethernet switch
	\item appliance
	\item modem
	\item server computer
	\item electric space heater
\end{itemize}

The problem with such a comparison is, that it is best 
if all buildings would use the same appliance.
Since that is not the case, missing appliances are portrayed as always off. 

This is the main reason why we can see in figure \ref{fig:tsne_boa_scatter_refit8} the clusters are nicely formed
but are separated quite a lot. We can still see that some clusters are closer than others,
meaning they are more similar.

\begin{figure}[H]
	\centering
	\caption{"Projection of bag of appliances load profiles for various buildings"}
	\includegraphics[width=.8\textwidth]{Figures/TSNE/TSNE_BOA/refit/scatter_refit_all.png}
	\label{fig:tsne_boa_scatter_refit8}
\end{figure}

Figure \ref{fig:tsne_boa_img_scatter_refit8} shows that load profiles are split 
between two poles. By observing the figure it is possible to see that the bottom Clusters
all have more than one active white good with a compressor (fridges and freezers), while
the top ones have only one. In general, the bottom buildings have more appliances,
with more activity than the top ones. 

\begin{figure}[H]
	\centering
	\caption{"Projection of bag of appliances load profiles for various buildings with actual samples"}
	\includegraphics[width=.9\textwidth]{Figures/TSNE/TSNE_BOA/refit/img_scatter_refitall.png}
	\label{fig:tsne_boa_img_scatter_refit8}
\end{figure}